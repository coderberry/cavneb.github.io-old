
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>coderberry</title>
  <meta name="author" content="Eric Berry">

  
  <meta name="description" content="Let&#8217;s pick up where we left off. If you haven&#8217;t already, make sure you go through Part 1 to create your base Rails app with the API setup &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://coderberry.me">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="coderberry" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-26417518-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">coderberry</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:coderberry.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/23/angularjs-on-rails-4-part-2/">AngularJS on Rails 4 - Part 2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-23T07:35:00-06:00" pubdate data-updated="true">Apr 23<span>rd</span>, 2013</time>
        
         | <a href="/blog/2013/04/23/angularjs-on-rails-4-part-2/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Let&#8217;s pick up where we left off. If you haven&#8217;t already, make sure you go through <a href="/blog/2013/04/22/angularjs-on-rails-4-part-1/">Part 1</a> to create your base Rails app with the API setup.</p>

<p>You can either continue using the code you have created on part 1 or you can catch up by checking out the tagged code:</p>

<pre><code>$ git clone https://github.com/cavneb/angular_casts
$ cd angular_casts
$ git checkout 'step-2'
$ bundle install
$ rake db:migrate
</code></pre>

<h2>Add AngularJS Libraries</h2>

<p>There are a couple of different ways we can add AngularJS into our application. <a href="http://railscasts.com/episodes/405-angularjs">Ryan Bates</a> suggests using the <a href="https://github.com/hiravgandhi/angularjs-rails">angular-rails gem</a>. I found this to be a bit outdated and overkill for what we are trying to do. Not only that, it&#8217;s good to know how to do this without a gem.</p>

<p>Go to <a href="http://code.angularjs.org/1.0.6/">http://code.angularjs.org/1.0.6/</a> and download the following files into your vendor/assets/javascripts folder:</p>

<ul>
<li><a href="http://code.angularjs.org/1.0.6/angular.js">http://code.angularjs.org/1.0.6/angular.js</a></li>
<li><a href="http://code.angularjs.org/1.0.6/angular-resource.js">http://code.angularjs.org/1.0.6/angular-resource.js</a></li>
</ul>


<p>Here&#8217;s a shortcut to do this:</p>

<pre><code>$ wget http://code.angularjs.org/1.0.6/angular.js -P vendor/assets/javascripts
$ wget http://code.angularjs.org/1.0.6/angular-resource.js -P vendor/assets/javascripts
</code></pre>

<h3>Setup the Javascript Folders</h3>

<p>We want to keep our code organized. We will place our controllers, filters, services, directives, etc. in the app/assets/javascripts folder. Create the following directories:</p>

<ul>
<li>app/assets/javascripts/angular/controllers</li>
<li>app/assets/javascripts/angular/directives</li>
<li>app/assets/javascripts/angular/filters</li>
<li>app/assets/javascripts/angular/models</li>
<li>app/assets/javascripts/angular/services</li>
</ul>


<p>Here&#8217;s a shortcut to do this:</p>

<pre><code>$ mkdir -p app/assets/javascripts/angular/controllers \
           app/assets/javascripts/angular/directives \
           app/assets/javascripts/angular/filters \
           app/assets/javascripts/angular/models \
           app/assets/javascripts/angular/services
</code></pre>

<p>We will not use all of these folders, but it is good to have them there so when we do end up needing to create additional files, we know where to put them.</p>

<h3>Update the Asset Pipeline</h3>

<p>Let&#8217;s do some cleanup of the Asset Pipeline. First, create the main javascript file which will drive our AngularJS application.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># app/assets/javascripts/angular_casts.js.coffee</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@app = </span><span class="nx">angular</span><span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s">&#39;AngularCasts&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;ngResource&#39;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this file we create a new module called <em>AngularCasts</em> and assign it to <code>@app</code>. We also add the dependency of <code>ngResource</code> which is our angular-resource.js file.</p>

<p>Now open up <em>app/assets/javascripts/application.js</em> and make the following changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//= require angular</span>
</span><span class='line'><span class="c1">//= require angular-resource</span>
</span><span class='line'><span class="c1">//= require angular_casts</span>
</span><span class='line'><span class="c1">//= require_tree ./angular</span>
</span></code></pre></td></tr></table></div></figure>


<p>The order of these is important due to the latter ones depending on the ones prior to them. Note that we do not have jQuery in here. AngularJS works great without jQuery and by removing it, we are forced to think the <em>Angular</em> way.</p>

<p>Let&#8217;s now clean up our Gemfile. We no longer have any dependencies on <em>jquery</em>, <em>turbolinks</em> or <em>jbuilder</em>. Remove them from the Gemfile.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Gemfile</span>
</span><span class='line'>
</span><span class='line'><span class="n">source</span> <span class="s1">&#39;https://rubygems.org&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;4.0.0.beta1&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span>
</span><span class='line'><span class="n">gem</span> <span class="s1">&#39;feedzirra&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">group</span> <span class="ss">:assets</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;sass-rails&#39;</span><span class="p">,</span>   <span class="s1">&#39;~&gt; 4.0.0.beta1&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;coffee-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 4.0.0.beta1&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;uglifier&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;= 1.0.3&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run <code>bundle install</code> to remove the gems from <code>Gemfile.lock</code>.</p>

<pre><code>$ bundle install
</code></pre>

<p>Now that we have removed this, we need to update our layout to not include these libraries. Open up <em>app/views/layouts/application.html.erb</em> and update the javascript and stylesheet includes to the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="sx">%= stylesheet_link_tag    &quot;application&quot;, media: &quot;all&quot; %&gt;</span>
</span><span class='line'><span class="sx">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s2">&quot;application&quot;</span> <span class="o">%&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Let&#8217;s Get It Working!</h2>

<p>We now have everything in place for our AngularJS application except for the view. We are going to use a simple controller named <code>home</code> with a single view, <code>index</code>.</p>

<p>Run the following command:</p>

<pre><code>$ rails g controller home index
</code></pre>

<p>We now have a controller and view. Let&#8217;s set this to as our <em>root_path</em> in <code>routes.rb</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config/routes.rb</span>
</span><span class='line'>
</span><span class='line'><span class="ss">AngularCasts</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/episodes&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;episodes#index&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span>
</span><span class='line'>  <span class="n">get</span> <span class="s1">&#39;/episodes/:id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;episodes#show&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">root</span> <span class="ss">to</span><span class="p">:</span> <span class="s1">&#39;home#index&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><em>Note that the line <code>get 'home#index'</code> was removed. This is not needed because the root path directs to it.</em></p>

<p>Let&#8217;s start our app up and make sure it&#8217;s working.</p>

<pre><code>$ rails s
</code></pre>

<p>Now open <a href="http://localhost:3000">http://localhost:3000</a>. Works? YAY!</p>

<h3>Adding Angular to our Views</h3>

<p>For our app to recognize that it is an Angular application, we need to add the ng-app attribute to the html tag on our layout.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- app/views/layouts/application.html.erb --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">ng-app=</span><span class="s">&quot;AngularCasts&quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&#8217;s create a controller that will be used to list out the episodes. Create a new coffeescript file at <em>app/assets/javascripts/angular/controllers/episodes_ctrl.js.coffee</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># app/assets/javascripts/angular/controllers/episodes_ctrl.js.coffee</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@EpisodesCtrl = </span><span class="nx">@app</span><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;EpisodesCtrl&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;$scope&quot;</span><span class="p">,</span> <span class="nf">($scope) -&gt;</span>
</span><span class='line'>  <span class="nv">$scope.message = </span><span class="s">&quot;Angular Rocks!&quot;</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&#8217;s update our controller view as well to display the message.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- app/views/home/index.html.erb --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;header&gt;</span>
</span><span class='line'>  AngularCasts
</span><span class='line'><span class="nt">&lt;/header&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">&quot;EpisodesCtrl&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h1&gt;</span>Message: {{message}}<span class="nt">&lt;/h1&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we have bound the contents of the <em>div</em> to the controller <em>EpisodesCtrl</em>. Refresh the browser and you should see &#8216;Message: Angular Rocks!&#8217;</p>

<h2>List the Episodes</h2>

<p>Now that we have Angular talking to our views, let&#8217;s integrate our episodes data. Remember that we can access the JSON data by calling <a href="http://localhost:3000/episodes.json">http://localhost:3000/episodes.json</a>.</p>

<p>Modify your controller to perform the ajax request and place the results into the <code>$scope</code></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># app/assets/javascripts/angular/controllers/episodes_ctrl.js.coffee</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@EpisodesCtrl = </span><span class="nx">@app</span><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;EpisodesCtrl&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;$scope&quot;</span><span class="p">,</span> <span class="s">&quot;$http&quot;</span><span class="p">,</span> <span class="nf">($scope, $http) -&gt;</span>
</span><span class='line'>  <span class="nv">$scope.episodes = </span><span class="p">[]</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">loadEpisodes = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;/episodes.json&quot;</span><span class="p">).</span><span class="nx">success</span><span class="p">(</span><span class="nf">(data, status, headers, config) -&gt;</span>
</span><span class='line'>      <span class="nx">angular</span><span class="p">.</span><span class="nx">forEach</span> <span class="nx">data</span><span class="p">,</span> <span class="nf">(value) -&gt;</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">episodes</span><span class="p">.</span><span class="nx">push</span> <span class="nx">value</span><span class="p">.</span><span class="nx">episode</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">loadEpisodes</span><span class="p">()</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>*** DESCRIPTION TO FOLLOW</p>

<p>Let&#8217;s update our view as well to list out the episodes in the scope.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- app/views/home/index.html.erb --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;header&gt;</span>
</span><span class='line'>  AngularCasts
</span><span class='line'><span class="nt">&lt;/header&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">&quot;EpisodesCtrl&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;episode-list-container&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li</span> <span class="na">ng-repeat=</span><span class="s">&quot;episode in episodes&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3&gt;</span>{{episode.title}} <span class="nt">&lt;small&gt;</span>({{episode.duration}})<span class="nt">&lt;/small&gt;&lt;/h3&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Try it out. If all worked well, you should see a list of episodes. Now lets add the much needed CSS to our application. Copy the following into <em>app/assets/stylesheets/episodes.css.scss</em></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="c">/* app/assets/stylesheets/episodes.css.scss */</span>
</span><span class='line'>
</span><span class='line'><span class="nt">body</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">font-size</span><span class="o">:</span> <span class="m">12px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">font-family</span><span class="o">:</span> <span class="n">Helvetica</span><span class="o">,</span> <span class="k">sans-serif</span><span class="p">;</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="m">#ddd</span><span class="p">;</span>
</span><span class='line'>  <span class="k">margin</span><span class="o">:</span> <span class="m">0px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nt">header</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="m">#4F4F4F</span><span class="p">;</span>
</span><span class='line'>  <span class="k">color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
</span><span class='line'>  <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
</span><span class='line'>  <span class="k">height</span><span class="o">:</span> <span class="m">36px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">top</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">left</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">right</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">font-size</span><span class="o">:</span> <span class="m">18px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">line-height</span><span class="o">:</span> <span class="m">36px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">font-weight</span><span class="o">:</span> <span class="k">bold</span><span class="p">;</span>
</span><span class='line'>  <span class="k">padding-left</span><span class="o">:</span> <span class="m">15px</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="nf">#episode-list-container</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
</span><span class='line'>  <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
</span><span class='line'>  <span class="k">width</span><span class="o">:</span> <span class="m">300px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">top</span><span class="o">:</span> <span class="m">37px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">left</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">bottom</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">overflow</span><span class="o">:</span> <span class="k">auto</span><span class="p">;</span>
</span><span class='line'>  <span class="o">-</span><span class="n">webkit</span><span class="o">-</span><span class="k">overflow</span><span class="o">-</span><span class="n">scrolling</span><span class="o">:</span> <span class="n">touch</span><span class="p">;</span>
</span><span class='line'>  <span class="n">ul</span> <span class="err">{</span>
</span><span class='line'>    <span class="k">margin</span><span class="o">:</span> <span class="m">0px</span><span class="p">;</span>
</span><span class='line'>    <span class="k">list-style</span><span class="o">:</span> <span class="k">none</span><span class="p">;</span>
</span><span class='line'>    <span class="k">padding</span><span class="o">:</span> <span class="m">0px</span><span class="p">;</span>
</span><span class='line'>    <span class="n">li</span> <span class="err">{</span>
</span><span class='line'>      <span class="k">cursor</span><span class="o">:</span> <span class="k">pointer</span><span class="p">;</span>
</span><span class='line'>      <span class="k">border-bottom</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#ddd</span><span class="p">;</span>
</span><span class='line'>      <span class="k">padding</span><span class="o">:</span> <span class="m">0</span> <span class="m">10px</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="err">}</span>
</span><span class='line'>  <span class="nt">h3</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">font-size</span><span class="o">:</span> <span class="m">14px</span><span class="p">;</span>
</span><span class='line'>    <span class="n">small</span> <span class="err">{</span>
</span><span class='line'>      <span class="k">font-size</span><span class="o">:</span> <span class="m">12px</span><span class="p">;</span>
</span><span class='line'>      <span class="k">color</span><span class="o">:</span> <span class="m">#ccc</span><span class="p">;</span>
</span><span class='line'>      <span class="k">font-weight</span><span class="o">:</span> <span class="k">normal</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="o">&amp;</span><span class="nc">.active</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">color</span><span class="o">:</span> <span class="nb">red</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="err">}</span>
</span><span class='line'><span class="err">}</span>
</span><span class='line'><span class="nf">#episode-view-container</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">position</span><span class="o">:</span> <span class="k">absolute</span><span class="p">;</span>
</span><span class='line'>  <span class="k">border-left</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#d0d0d0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">top</span><span class="o">:</span> <span class="m">37px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">left</span><span class="o">:</span> <span class="m">300px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">right</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">bottom</span><span class="o">:</span> <span class="m">0</span><span class="p">;</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="m">#fff</span><span class="p">;</span>
</span><span class='line'>  <span class="k">min-height</span><span class="o">:</span> <span class="m">400px</span><span class="p">;</span>
</span><span class='line'>  <span class="k">padding</span><span class="o">:</span> <span class="m">5px</span> <span class="m">25px</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="m">#player</span> <span class="err">{</span>
</span><span class='line'>    <span class="k">border</span><span class="o">:</span> <span class="m">1px</span> <span class="k">solid</span> <span class="m">#000</span><span class="p">;</span>
</span><span class='line'>    <span class="k">max-width</span><span class="o">:</span> <span class="m">800px</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="err">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Refresh the browser again. Ooooh!</p>

<h2>Show the Selected Episode</h2>

<p>When we click on the episode on the left, we want to be able to view the episode with more information in the main area. This can be done in a few steps:</p>

<h3>Add an event listener to the episode</h3>

<p>This is an easy part. Add the ng-click attribute to the <em>h3</em> tag to call the method <em>showEpisode</em>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;h3</span> <span class="na">ng-click=</span><span class="s">&quot;showEpisode(episode)&quot;</span><span class="nt">&gt;</span>{{episode.title}} <span class="nt">&lt;small&gt;</span>({{episode.duration}})<span class="nt">&lt;/small&gt;&lt;/h3&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, we added <code>ng-click="showEpisode(episode)"</code> to the <em>h3</em> tag. The function call takes the episode as it&#8217;s parameter, which is available from the ng-repeat.</p>

<h3>Add the function into the controller</h3>

<p>Let&#8217;s add the <em>showEpisode</em> function to our controller.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># app/assets/javascripts/angular/controllers/episodes_ctrl.js.coffee</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@EpisodesCtrl = </span><span class="nx">@app</span><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;EpisodesCtrl&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;$scope&quot;</span><span class="p">,</span> <span class="s">&quot;$http&quot;</span><span class="p">,</span> <span class="nf">($scope, $http) -&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.episodes = </span><span class="p">[]</span>
</span><span class='line'>  <span class="nv">$scope.selectedEpisode = </span><span class="kc">null</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.showEpisode = </span><span class="nf">(episode) -&gt;</span>
</span><span class='line'>    <span class="nv">$scope.selectedEpisode = </span><span class="nx">episode</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">loadEpisodes = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;/episodes.json&quot;</span><span class="p">).</span><span class="nx">success</span><span class="p">(</span><span class="nf">(data, status, headers, config) -&gt;</span>
</span><span class='line'>      <span class="nx">angular</span><span class="p">.</span><span class="nx">forEach</span> <span class="nx">data</span><span class="p">,</span> <span class="nf">(value) -&gt;</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">episodes</span><span class="p">.</span><span class="nx">push</span> <span class="nx">value</span><span class="p">.</span><span class="nx">episode</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">loadEpisodes</span><span class="p">()</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>On line 6, we added the scoped variable <em>selectedEpisode</em> with a default value of <em>null</em>.</p>

<p>On lines 8-9, we added the scoped function which is called by the <em>ng-click</em> and sets the <em>selectedEpisode</em> value to the passed in episode.</p>

<p>Now back on the view, let&#8217;s add the container for the <em>show</em> view.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- app/views/home/index.html.erb --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;header&gt;</span>
</span><span class='line'>  AngularCasts
</span><span class='line'><span class="nt">&lt;/header&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">ng-controller=</span><span class="s">&quot;EpisodesCtrl&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;episode-list-container&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ul&gt;</span>
</span><span class='line'>      <span class="nt">&lt;li</span> <span class="na">ng-repeat=</span><span class="s">&quot;episode in episodes&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;h3</span> <span class="na">ng-click=</span><span class="s">&quot;showEpisode(episode)&quot;</span><span class="nt">&gt;</span>{{episode.title}} <span class="nt">&lt;small&gt;</span>({{episode.duration}})<span class="nt">&lt;/small&gt;&lt;/h3&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ul&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;episode-view-container&quot;</span> <span class="na">ng-show=</span><span class="s">&quot;selectedEpisode&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h2&gt;</span>{{selectedEpisode.title}}<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>    <span class="nt">&lt;p&gt;</span>{{selectedEpisode.description}}<span class="nt">&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;player&quot;</span><span class="nt">&gt;&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we have added lines 16-21. In our container div, there is the attribute <code>ng-show="selectedEpisode"</code>. This ensures that the div is only visible if the scoped variable <em>selectedEpisode</em> is set. Line 20 will contain our video, but we&#8217;ll get to that.</p>

<p>Then inside the div, we display the episode information for the selected episode.</p>

<p>Try it out by <a href="http://localhost:3000">reloading your browser</a>.</p>

<h3>Embed the Video</h3>

<p>Now that we can see the individual episode information, we can add the video embed code. For this we are going to use <a href="http://flowplayer.org">flowplayer</a>. It is fairly simple to set up.</p>

<p>First we need to add the required <em>css</em> and <em>javascript</em> libraries to our layout. Open up <em>application.html.erb</em> and make the following changes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="c">&lt;!-- app/views/layouts/application.html.erb --&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html</span> <span class="na">ng-app=</span><span class="s">&quot;AngularCasts&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;head&gt;</span>
</span><span class='line'>  <span class="nt">&lt;title&gt;</span>AngularCasts<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>  <span class="err">&lt;</span>%= stylesheet_link_tag &quot;application&quot;, &quot;http://releases.flowplayer.org/5.4.0/skin/minimalist.css&quot; %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= javascript_include_tag &quot;application&quot;,
</span><span class='line'>                             &quot;http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js&quot;,
</span><span class='line'>                             &quot;http://releases.flowplayer.org/5.4.0/flowplayer.min.js&quot; %&gt;
</span><span class='line'>  <span class="err">&lt;</span>%= csrf_meta_tags %&gt;
</span><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="err">&lt;</span>%= yield %&gt;
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we added a new stylesheet and two additional javascript files to our include tags. As you can see, jQuery was included. This is a dependency of flowplayer, so we had to add it. But we have made it this far without it!</p>

<p>Now we can embed the video from within our controller. This is very simple.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># app/assets/javascripts/angular/controllers/episodes_ctrl.js.coffee</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@EpisodesCtrl = </span><span class="nx">@app</span><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;EpisodesCtrl&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;$scope&quot;</span><span class="p">,</span> <span class="s">&quot;$http&quot;</span><span class="p">,</span> <span class="nf">($scope, $http) -&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.episodes = </span><span class="p">[]</span>
</span><span class='line'>  <span class="nv">$scope.selectedEpisode = </span><span class="kc">null</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.showEpisode = </span><span class="nf">(episode) -&gt;</span>
</span><span class='line'>    <span class="nv">$scope.selectedEpisode = </span><span class="nx">episode</span>
</span><span class='line'>    <span class="nx">loadVideo</span><span class="p">(</span><span class="nx">episode</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">loadVideo = </span><span class="nf">(episode) -&gt;</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">player&quot;</span><span class="p">).</span><span class="nx">flowplayer</span>
</span><span class='line'>      <span class="nv">playlist: </span><span class="p">[[</span><span class="nv">mp4: </span><span class="nx">episode</span><span class="p">.</span><span class="nx">video_url</span><span class="p">]]</span>
</span><span class='line'>      <span class="nv">ratio: </span><span class="mi">9</span> <span class="o">/</span> <span class="mi">14</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">loadEpisodes = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;/episodes.json&quot;</span><span class="p">).</span><span class="nx">success</span><span class="p">(</span><span class="nf">(data, status, headers, config) -&gt;</span>
</span><span class='line'>      <span class="nx">angular</span><span class="p">.</span><span class="nx">forEach</span> <span class="nx">data</span><span class="p">,</span> <span class="nf">(value) -&gt;</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">episodes</span><span class="p">.</span><span class="nx">push</span> <span class="nx">value</span><span class="p">.</span><span class="nx">episode</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">loadEpisodes</span><span class="p">()</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>On line 10, we added a call to the function <em>loadVideo</em> passing in the episode.</p>

<p>On lines 12-15, we define a function which performs the javascript in order to load the video into <code>&lt;div id="player"&gt;&lt;/div&gt;</code>. You can see that we pass in the episode&#8217;s video_url as the mp4 and set the ratio to 9/14.</p>

<p>Let&#8217;s give it another go. Refresh your browser. You should now have a fully-functional AngularJS application!!!</p>

<h2>Visual Feedback</h2>

<p>The final item we will be adding in our application is some visual feedback as to which video we are watching. In other words, we want to highlight the selected video on the left list.</p>

<p>Add the following <em>ng-class</em> attribute to the <em>h3</em> tag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'>...
</span><span class='line'><span class="nt">&lt;li</span> <span class="na">ng-repeat=</span><span class="s">&quot;episode in episodes&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;h3</span> <span class="na">ng-click=</span><span class="s">&quot;showEpisode(episode)&quot;</span> <span class="na">ng-class=</span><span class="s">&quot;isSelected(episode)&quot;</span><span class="nt">&gt;</span> <span class="nt">&lt;small&gt;</span>()<span class="nt">&lt;/small&gt;&lt;/h3&gt;</span>
</span><span class='line'><span class="nt">&lt;/li&gt;</span>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>We now are using the function <code>isSelected(episode)</code> as the class name. Let&#8217;s add this to our controller.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="c1"># app/assets/javascripts/angular/controllers/episodes_ctrl.js.coffee</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@EpisodesCtrl = </span><span class="nx">@app</span><span class="p">.</span><span class="nx">controller</span> <span class="s">&#39;EpisodesCtrl&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&quot;$scope&quot;</span><span class="p">,</span> <span class="s">&quot;$http&quot;</span><span class="p">,</span> <span class="nf">($scope, $http) -&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.episodes = </span><span class="p">[]</span>
</span><span class='line'>  <span class="nv">$scope.selectedEpisode = </span><span class="kc">null</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.showEpisode = </span><span class="nf">(episode) -&gt;</span>
</span><span class='line'>    <span class="nv">$scope.selectedEpisode = </span><span class="nx">episode</span>
</span><span class='line'>    <span class="nx">loadVideo</span><span class="p">(</span><span class="nx">episode</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$scope.isSelected = </span><span class="nf">(episode) -&gt;</span>
</span><span class='line'>    <span class="s">&#39;active&#39;</span> <span class="k">if</span> <span class="nx">$scope</span><span class="p">.</span><span class="nx">selectedEpisode</span> <span class="o">==</span> <span class="nx">episode</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">loadVideo = </span><span class="nf">(episode) -&gt;</span>
</span><span class='line'>    <span class="nx">$</span><span class="p">(</span><span class="s">&quot;</span><span class="err">#</span><span class="s">player&quot;</span><span class="p">).</span><span class="nx">flowplayer</span>
</span><span class='line'>      <span class="nv">playlist: </span><span class="p">[[</span><span class="nv">mp4: </span><span class="nx">episode</span><span class="p">.</span><span class="nx">video_url</span><span class="p">]]</span>
</span><span class='line'>      <span class="nv">ratio: </span><span class="mi">9</span> <span class="o">/</span> <span class="mi">14</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">loadEpisodes = </span><span class="nf">-&gt;</span>
</span><span class='line'>    <span class="nx">$http</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;/episodes.json&quot;</span><span class="p">).</span><span class="nx">success</span><span class="p">(</span><span class="nf">(data, status, headers, config) -&gt;</span>
</span><span class='line'>      <span class="nx">angular</span><span class="p">.</span><span class="nx">forEach</span> <span class="nx">data</span><span class="p">,</span> <span class="nf">(value) -&gt;</span>
</span><span class='line'>        <span class="nx">$scope</span><span class="p">.</span><span class="nx">episodes</span><span class="p">.</span><span class="nx">push</span> <span class="nx">value</span><span class="p">.</span><span class="nx">episode</span>
</span><span class='line'>    <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">loadEpisodes</span><span class="p">()</span>
</span><span class='line'><span class="p">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>On lines 12-13, we have added the function <em>isSelected</em>. It will return &#8216;active&#8217; if the selectedEpisode is the episode that was clicked.</p>

<h2>Final Product</h2>

<p><img src="http://f.cl.ly/items/2r0I1w1L3d1s0N0l2A0v/angular_casts.png"></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/04/22/angularjs-on-rails-4-part-1/">AngularJS on Rails 4 - Part 1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-22T22:28:00-06:00" pubdate data-updated="true">Apr 22<span>nd</span>, 2013</time>
        
         | <a href="/blog/2013/04/22/angularjs-on-rails-4-part-1/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div style="width: 242px;
      height: 388px;
      margin: 10px 30px 10px 0;
      float: left;
      background: transparent url(http://f.cl.ly/items/1n0f2g2z2w2U0s2h2t40/angular_mug.jpg) -60px -80px no-repeat;">
</div>


<p>AngularJS seems to be the big craze as of late. Some may agree and some may not, but AngularJS is one of the next big contenders for being the number one choice of developers. At the time of writing this article, AngularJS is the <a href="https://github.com/languages/JavaScript/most_watched">15th most watched project on GitHub</a>.</p>

<p>A few days back, I presented at our local <a href="http://utruby.org">ruby users group</a> on writing an API-driven Rails app with AngularJS on the front end. Since then, I have received a lot of feedback on how I could have enhanced the app. This article has been re-written to reflect those changes. <em>Special thanks goes to <a href="http://tadthorley.com/">Tad Thorley</a> for providing the <a href="https://github.com/phaedryx/angularcast-example">excellent example application</a> based off of the original.</em></p>

<p>Here I want to create a useful Rails application using AngularJS. The goal is to have a single-page application which allows us to select a screencast link on the left and view it on the right. An example of this would be found at <a href="http://ember101.com">http://ember101.com</a>.</p>

<h6>The title of the article states that we will be using Rails 4 in our application. We will be, however it is not necessary. There are no parts of this tutorial which use code specific to Rails 4.</h6>

<div style="clear: both;"></div>


<h2>Creating the Rails Application</h2>

<p>I had a hard time deciding when I began this project on whether to use a full Rails application or a very lightweight ruby web stack like <a href="http://sinatrarb.com">Sinatra</a>. In a <a href="http://railscasts.com/episodes/348-the-rails-api-gem">Railscast</a> by Ryan Bates, he describes an excellent middle-ground solution called <a href="https://github.com/rails-api/rails-api">Rails-Api</a>. By using the rails-api gem, we can make our Rails app much more lightweight and consequently faster than a normal Rails application.</p>

<p>Before anything, we need to install the <em>rails-api</em> gem in order for us to create our app.</p>

<pre><code>$ gem install rails-api
</code></pre>

<p>Once that is installed, lets create a new Rails application called <em>Angular Casts</em></p>

<pre><code>$ rails-api new angular_casts
</code></pre>

<p>For those familiar with Rails, you will notice that a lot of the auto-generated code has been removed. No helpers, views or even the asset pipeline are there. Being someone who loves CoffeeScript, I want to add the asset pipeline back into our app. With the rails-api gem, the asset pipeline support hasn&#8217;t been removed, just hidden. To re-enable this to use CoffeeScript, you will need to re-create the pipeline directory <em>app/assets/javascripts</em>:</p>

<pre><code>$ mkdir -p app/assets/javascripts
</code></pre>

<p>and then create a <a href="http://coderberry.me/blog/2012/04/24/asset-pipeline-for-dummies/">manifest file</a> called <em>application.js</em>:</p>

<figure class='code'><figcaption><span>app/assets/javascripts/application.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//= require app</span>
</span><span class='line'><span class="c1">//= require_tree .</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Create the Model</h2>

<p>Our application will be pretty simple. We are only going to worry about storing screencast information in our database. Rails by default comes with a very lightweight database server called SQLite. If you aren&#8217;t familiar with this, you can visit <a href="http://guides.rubyonrails.org/getting_started.html#configuring-a-database">http://guides.rubyonrails.org/getting_started.html#configuring-a-database</a> to learn more.</p>

<p>Before we create our model, we need to determine what information we want to store. As a user of this application, I think the most useful would be:</p>

<ul>
<li><em>title</em>: What is the name of the screencast?</li>
<li><em>summary</em>: What is the screencast about?</li>
<li><em>duration</em>: How long is the screencast?</li>
<li><em>link</em>: How do I get to the original screencast?</li>
<li><em>published</em>: When was the screencast published?</li>
<li><em>source</em>: Who is the provider of the screencast?</li>
</ul>


<p>Let&#8217;s create a model based on this information. We need to add the <em>video_url</em> field as well, which will be used to embed the video into our app.</p>

<pre><code>$ rails-api g model screencast title summary:text duration link published_at:datetime, source, video_url --timestamps=false
</code></pre>

<p>Note that in our generate command, we skipped timestamps. By having the published_at date and time, we don&#8217;t need to store the additional information <em>unless you really really wanted to</em>.</p>

<p>Run the migration tasks for both development and test environments:</p>

<pre><code>$ rake db:migrate
$ rake db:migrate RAILS_ENV=test
</code></pre>

<h3>Testing the Model</h3>

<h6>Testing is not the primary topic of these blog posts, so less time and explanation will be given to them. If you want to learn more about testing, I recommend <a href="http://railscasts.com/episodes/275-how-i-test">http://railscasts.com/episodes/275-how-i-test</a>.</h6>

<p>For us to have a long-lasting, maintainable application it is imperative that we keep our code tested. This will also help us stay focused on what our application and code is supposed to do.</p>

<p>Start by running the rake task for testing to see make sure the tests run:</p>

<pre><code>$ rake test
</code></pre>

<p>If all worked well, you should see something like <strong>0 tests, 0 assertions, 0 failures, 0 errors, 0 skips</strong>. This means that the test suite ran, but it didn&#8217;t find any tests to run.</p>

<p>Open up the auto-generated file <em>test/models/screencast_test.rb</em>.</p>

<p>There are a few things we will want to test. Let&#8217;s list them out:</p>

<ol>
<li>Make sure that all the required data exists for each screencast.</li>
<li>Make sure that we do not have two of the same screencast (duplicates).</li>
</ol>


<p>Now that we have the list, we can write our tests. Let&#8217;s first update our fixtures file with some useable data:</p>

<figure class='code'><figcaption><span>test/fixtures/screencasts.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="c1"># Read about fixtures at http://api.rubyonrails.org/classes/ActiveRecord/Fixtures.html</span>
</span><span class='line'>
</span><span class='line'><span class="l-Scalar-Plain">fast_rails_commands</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">title</span><span class="p-Indicator">:</span> <span class="s">&quot;Fast</span><span class="nv"> </span><span class="s">Rails</span><span class="nv"> </span><span class="s">Commands&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">summary</span><span class="p-Indicator">:</span> <span class="s">&quot;Rails</span><span class="nv"> </span><span class="s">commands,</span><span class="nv"> </span><span class="s">such</span><span class="nv"> </span><span class="s">as</span><span class="nv"> </span><span class="s">generators,</span><span class="nv"> </span><span class="s">migrations,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">tests,</span><span class="nv"> </span><span class="s">have</span><span class="nv"> </span><span class="s">a</span><span class="nv"> </span><span class="s">tendency</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">be</span><span class="nv"> </span><span class="s">slow</span><span class="nv"> </span><span class="s">because</span><span class="nv"> </span><span class="s">they</span><span class="nv"> </span><span class="s">need</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">load</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">Rails</span><span class="nv"> </span><span class="s">app</span><span class="nv"> </span><span class="s">each</span><span class="nv"> </span><span class="s">time.</span><span class="nv"> </span><span class="s">Here</span><span class="nv"> </span><span class="s">I</span><span class="nv"> </span><span class="s">show</span><span class="nv"> </span><span class="s">three</span><span class="nv"> </span><span class="s">tools</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">make</span><span class="nv"> </span><span class="s">this</span><span class="nv"> </span><span class="s">faster:</span><span class="nv"> </span><span class="s">Zeus,</span><span class="nv"> </span><span class="s">Spring,</span><span class="nv"> </span><span class="s">and</span><span class="nv"> </span><span class="s">Commands.&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">duration</span><span class="p-Indicator">:</span> <span class="s">&quot;8:06&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">link</span><span class="p-Indicator">:</span> <span class="s">&quot;http://railscasts.com/episodes/412-fast-rails-commands&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">published_at</span><span class="p-Indicator">:</span> <span class="s">&quot;Thu,</span><span class="nv"> </span><span class="s">04</span><span class="nv"> </span><span class="s">Apr</span><span class="nv"> </span><span class="s">2013</span><span class="nv"> </span><span class="s">00:00:00</span><span class="nv"> </span><span class="s">-0700&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">source</span><span class="p-Indicator">:</span> <span class="s">&quot;railscasts&quot;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">video_url</span><span class="p-Indicator">:</span> <span class="s">&quot;http://media.railscasts.com/assets/episodes/videos/412-fast-rails-commands.mp4&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now open up <em>test/models/screencast_test.rb</em> and add the following tests:</p>

<figure class='code'><figcaption><span>test/models/screencast_test.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;test_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">ScreencastTest</span> <span class="o">&lt;</span> <span class="ss">ActiveSupport</span><span class="p">:</span><span class="ss">:TestCase</span>
</span><span class='line'>  <span class="n">setup</span> <span class="k">do</span>
</span><span class='line'>    <span class="vi">@screencast_defaults</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>      <span class="ss">title</span><span class="p">:</span>        <span class="s1">&#39;Facebook Authentication&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">summary</span><span class="p">:</span>      <span class="s1">&#39;This will show how to create a new facebook application and configure it. Then add some authentication with the omniauth-facebook gem and top it off with a client-side authentication using the JavaScript SDK.&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">duration</span><span class="p">:</span>     <span class="s1">&#39;12:09&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="ss">link</span><span class="p">:</span>         <span class="s1">&#39;http://railscasts.com/episodes/360-facebook-authentication&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">published_at</span><span class="p">:</span> <span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s1">&#39;Mon, 25 Jun 2012 00:00:00 -0700&#39;</span><span class="p">),</span>
</span><span class='line'>      <span class="ss">source</span><span class="p">:</span>       <span class="s1">&#39;railscasts&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="n">video_url</span><span class="p">:</span>    <span class="s1">&#39;http://media.railscasts.com/assets/episodes/videos/360-facebook-authentication.mp4&#39;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">test</span> <span class="s2">&quot;should be invalid if missing required data&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">screencast</span> <span class="o">=</span> <span class="no">Screencast</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>    <span class="n">assert</span> <span class="o">!</span><span class="n">screencast</span><span class="o">.</span><span class="n">valid?</span>
</span><span class='line'>    <span class="o">[</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:summary</span><span class="p">,</span> <span class="ss">:duration</span><span class="p">,</span> <span class="ss">:link</span><span class="p">,</span> <span class="ss">:published_at</span><span class="p">,</span> <span class="ss">:source</span><span class="p">,</span> <span class="ss">:video_url</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">field_name</span><span class="o">|</span>
</span><span class='line'>      <span class="n">assert</span> <span class="n">screencast</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">include?</span> <span class="n">field_name</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">test</span> <span class="s2">&quot;should be valid if required data exists&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">screencast</span> <span class="o">=</span> <span class="no">Screencast</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@screencast_defaults</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert</span> <span class="n">screencast</span><span class="o">.</span><span class="n">valid?</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">test</span> <span class="s2">&quot;should only allow one screencast with the same video url&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">screencast</span> <span class="o">=</span> <span class="no">Screencast</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="vi">@screencast_defaults</span><span class="p">)</span>
</span><span class='line'>    <span class="n">screencast</span><span class="o">.</span><span class="n">video_url</span> <span class="o">=</span> <span class="n">screencasts</span><span class="p">(</span><span class="ss">:fast_rails_commands</span><span class="p">)</span><span class="o">.</span><span class="n">video_url</span>
</span><span class='line'>    <span class="n">assert</span> <span class="o">!</span><span class="n">screencast</span><span class="o">.</span><span class="n">valid?</span>
</span><span class='line'>    <span class="n">assert</span> <span class="n">screencast</span><span class="o">.</span><span class="n">errors</span><span class="o">[</span><span class="ss">:video_url</span><span class="o">].</span><span class="n">include?</span> <span class="s2">&quot;has already been taken&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Once this is in place, run the tests again with the command <code>rake test</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>rake <span class="nb">test</span>
</span><span class='line'>Run options: --seed 16385
</span><span class='line'>
</span><span class='line'><span class="c"># Running tests:</span>
</span><span class='line'>
</span><span class='line'>F.F
</span><span class='line'>
</span><span class='line'>Finished tests in 0.040478s, 74.1143 tests/s, 74.1143 assertions/s.
</span><span class='line'>
</span><span class='line'>  1<span class="o">)</span> Failure:
</span><span class='line'>ScreencastTest#test_should_be_invalid_if_missing_required_data <span class="o">[</span>/Users/eberry/Desktop/angular_casts/test/models/screencast_test.rb:18<span class="o">]</span>:
</span><span class='line'>Failed assertion, no message given.
</span><span class='line'>
</span><span class='line'>  2<span class="o">)</span> Failure:
</span><span class='line'>ScreencastTest#test_should_only_allow_one_screencast_with_the_same_video_url <span class="o">[</span>/Users/eberry/Desktop/angular_casts/test/models/screencast_test.rb:32<span class="o">]</span>:
</span><span class='line'>Failed assertion, no message given.
</span><span class='line'>
</span><span class='line'>3 tests, 3 assertions, 2 failures, 0 errors, 0 skips
</span><span class='line'>Errors running <span class="nb">test</span>:units! <span class="c">#&lt;RuntimeError: Command failed with status (1): [ruby -I&quot;lib:test&quot; -I&quot;/Users/eberry/.rvm/gems/ruby-1.9.3-p392/gems/rake-10.0.4/lib&quot; &quot;/Users/eberry/.rvm/gems/ruby-1.9.3-p392/gems/rake-10.0.4/lib/rake/rake_test_loader.rb&quot; &quot;test/{models,helpers,unit}/**/*_test.rb&quot; ]&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can see we have have 3 tests with 3 assertions and 2 failures. The reason we didn&#8217;t get 3 failures is because the second test, &#8220;should be valid if required data exists&#8221;, will always pass until we set up some restrictions on the model.</p>

<p>Let&#8217;s update the model to make these tests pass.</p>

<figure class='code'><figcaption><span>app/models/screencast.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Screencast</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">validates_presence_of</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:summary</span><span class="p">,</span> <span class="ss">:duration</span><span class="p">,</span> <span class="ss">:link</span><span class="p">,</span> <span class="ss">:published_at</span><span class="p">,</span> <span class="ss">:source</span><span class="p">,</span> <span class="ss">:video_url</span>
</span><span class='line'>  <span class="n">validates_uniqueness_of</span> <span class="ss">:video_url</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run the tests again to see them pass successfully!</p>

<h2>Importing the Video Data</h2>

<p>Because we are going to import video feeds from external sites, we need to use a feed parsing library. The best one available is <a href="https://github.com/pauldix/feedzirra">feedzirra</a>. Go ahead and add it to the Gemfile and run <code>bundle install</code>.</p>

<pre><code>gem 'feedzirra'

$ bundle install
</code></pre>

<h3>Create an Import Library</h3>

<p>Now that we have a place to put all of the screencast information, we need to be able to import it from external feeds. Here we are going to create a simple Ruby class that uses the <em>feedzirra</em> gem to grab the feed data, parse it and then add it to our database.</p>

<p>Let&#8217;s start off by creating a new class called <em>ScreencastImporter</em>. Paste the following code into <em>lib/screencast_importer.rb</em>.</p>

<figure class='code'><figcaption><span>lib/screencast_importer.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;feedzirra&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">ScreencastImporter</span>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">import_railscasts</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># because the Railscasts feed is targeted at itunes, there is additional metadata that</span>
</span><span class='line'>    <span class="c1"># is not collected by Feedzirra by default. By using add_common_feed_entry_element,</span>
</span><span class='line'>    <span class="c1"># we can let Feedzirra know how to map those values. See more information at</span>
</span><span class='line'>    <span class="c1"># http://www.ruby-doc.org/gems/docs/f/feedzirra-0.1.2/Feedzirra/Feed.html</span>
</span><span class='line'>    <span class="ss">Feedzirra</span><span class="p">:</span><span class="ss">:Feed</span><span class="o">.</span><span class="n">add_common_feed_entry_element</span><span class="p">(</span><span class="ss">:enclosure</span><span class="p">,</span> <span class="ss">:value</span> <span class="o">=&gt;</span> <span class="ss">:url</span><span class="p">,</span> <span class="ss">:as</span> <span class="o">=&gt;</span> <span class="ss">:video_url</span><span class="p">)</span>
</span><span class='line'>    <span class="ss">Feedzirra</span><span class="p">:</span><span class="ss">:Feed</span><span class="o">.</span><span class="n">add_common_feed_entry_element</span><span class="p">(</span><span class="s1">&#39;itunes:duration&#39;</span><span class="p">,</span> <span class="ss">:as</span> <span class="o">=&gt;</span> <span class="ss">:duration</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Capture the feed and iterate over each entry</span>
</span><span class='line'>    <span class="n">feed</span> <span class="o">=</span> <span class="ss">Feedzirra</span><span class="p">:</span><span class="ss">:Feed</span><span class="o">.</span><span class="n">fetch_and_parse</span><span class="p">(</span><span class="s2">&quot;http://feeds.feedburner.com/railscasts&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">feed</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">entry</span><span class="o">|</span>
</span><span class='line'>      <span class="c1"># Find or create the screencast data into our database</span>
</span><span class='line'>      <span class="no">Screencast</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">video_url</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">video_url</span><span class="p">)</span><span class="o">.</span><span class="n">first_or_create</span><span class="p">(</span>
</span><span class='line'>        <span class="ss">title</span><span class="p">:</span>        <span class="n">entry</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">summary</span><span class="p">:</span>      <span class="n">entry</span><span class="o">.</span><span class="n">summary</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">duration</span><span class="p">:</span>     <span class="n">entry</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">link</span><span class="p">:</span>         <span class="n">entry</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
</span><span class='line'>        <span class="n">published_at</span><span class="p">:</span> <span class="n">entry</span><span class="o">.</span><span class="n">published</span><span class="p">,</span>
</span><span class='line'>        <span class="ss">source</span><span class="p">:</span>       <span class="s1">&#39;railscasts&#39;</span> <span class="c1"># set this manually</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1"># Return the number of total screencasts for the source</span>
</span><span class='line'>    <span class="no">Screencast</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">source</span><span class="p">:</span> <span class="s1">&#39;railscasts&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now if we were to go into our Rails console, we could trigger this import manually. Give it a shot!</p>

<pre><code>$ rails c
Loading development environment (Rails 4.0.0.beta1)

&gt;&gt; require 'screencast_importer'
=&gt; true

&gt;&gt; ScreencastImporter.import_railscasts
=&gt; .... lots ... of .. feedback ....

&gt;&gt; Screencast.count
=&gt; 344
</code></pre>

<h3>Trigger Import via Rake</h3>

<p>Instead of loading up the Rails console and performing the import manually, it would me much easier to have a simple command that we could run to perform the imports. This is where <a href="http://rake.rubyforge.org/">rake tasks</a> come in. Let&#8217;s create a rake task that will perform the import.</p>

<figure class='code'><figcaption><span>lib/tasks/screencast_sync.rake</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;screencast_importer&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:screencast_sync</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">desc</span> <span class="s1">&#39;sync all missing screencasts from Railscasts.com&#39;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:railscasts</span> <span class="o">=&gt;</span> <span class="ss">:environment</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">total</span> <span class="o">=</span> <span class="no">ScreencastImporter</span><span class="o">.</span><span class="n">import_railscasts</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;There are now </span><span class="si">#{</span><span class="n">total</span><span class="si">}</span><span class="s2"> screencasts from Railscasts.com&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now that we have our rake task set up, go ahead and run the command:</p>

<pre><code>$ rake screencast_sync:railscasts
There are now 344 screencasts from Railscasts.com
</code></pre>

<p>It worked! But no time to celebrate.. let&#8217;s move on.</p>

<h2>Making Episodes Accessible via API</h2>

<p>Because we are planning on using AngularJS for our front-end, we only need to expose our data as JSON. This will allow AngularJS to talk to the backend via ajax calls.</p>

<p>We are going to only use two calls to the API:</p>

<ul>
<li><strong>/screencasts.json</strong> - returns a full list of episodes</li>
<li><strong>/screencasts/ID.json</strong> - returns data for a specified screencast (where ID is the unique ID of the screencast in our db)</li>
</ul>


<p>Let&#8217;s start by creating the controller. Run the following generator:</p>

<pre><code>$ rails-api g controller screencasts index show
</code></pre>

<p>By running this generator, the controller <code>ScreencastsController</code> was created. The routes file was also updated. Let&#8217;s do some cleanup to the routes and make sure we only are allowing what we want to use. On top of that, let&#8217;s <a href="http://guides.rubyonrails.org/routing.html#controller-namespaces-and-routing">scope</a> our calls to the API with <em>api</em>.</p>

<figure class='code'><figcaption><span>config/routes.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="ss">AngularCasts</span><span class="p">:</span><span class="ss">:Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">scope</span> <span class="ss">:api</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">get</span> <span class="s2">&quot;/screencasts(.:format)&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;screencasts#index&quot;</span>
</span><span class='line'>    <span class="n">get</span> <span class="s2">&quot;/screencasts/:id(.:format)&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;screencasts#show&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now update the controller to render the correct JSON data for the two URL&#8217;s.</p>

<figure class='code'><figcaption><span>app/controllers/screencast_controller.rb </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ScreencastsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="c1"># GET /screencasts</span>
</span><span class='line'>  <span class="c1"># GET /screencasts.json</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>    <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="no">Screencast</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1"># GET /screencasts/:id</span>
</span><span class='line'>  <span class="c1"># GET /screencasts/:id.json</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>    <span class="n">render</span> <span class="ss">json</span><span class="p">:</span> <span class="no">Screencast</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>One final thing that we need to do is tell Rails to not include the root in the JSON response. What this means is that the JSON response will not have a labelling key (e.g. <code>"screencast" =&gt; { "id": 1, ...</code>). To make this modification, add the following to your application controller:</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="ss">ActionController</span><span class="p">:</span><span class="ss">:API</span>
</span><span class='line'>  <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span><span class="o">.</span><span class="n">include_root_in_json</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Cool. If you are feeling brave, start up your Rails application and visit this link: <a href="http://localhost:3000/screencasts.json">http://localhost:3000/screencasts.json</a>. If all went well, you should see JSON data. You should also be able to view <a href="http://localhost:3000/screencasts/1.json">http://localhost:3000/screencasts/1.json</a> and see the data belonging to a single screencast.</p>

<p>Example:</p>

<figure class='code'><figcaption><span>http://localhost:3000/api/screencasts/1.json</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="s2">&quot;#412 Fast Rails Commands&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;summary&quot;</span><span class="o">:</span> <span class="s2">&quot;Rails commands, such as generators, migrations, and tests, have a tendency to be slow because they need to load the Rails app each time. Here I show three tools to make this faster: Zeus, Spring, and Commands.&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;duration&quot;</span><span class="o">:</span> <span class="s2">&quot;8:06&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;link&quot;</span><span class="o">:</span> <span class="s2">&quot;http://railscasts.com/episodes/412-fast-rails-commands&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;published_at&quot;</span><span class="o">:</span> <span class="s2">&quot;2013-04-04T07:00:00.000Z&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;railscasts&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;video_url&quot;</span><span class="o">:</span> <span class="s2">&quot;http://media.railscasts.com/assets/episodes/videos/412-fast-rails-commands.mp4&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Testing the API</h3>

<p>Of course we are going to test the API! It actually isn&#8217;t as complicated as it may seem. I am not going to go over much explanation beyond the inline comments.</p>

<p>Because we have scoped our route with &#8220;/api&#8221;, our auto-generated controller test does not work. This is not a bad thing. Delete it! We will not be performing a <em>controller</em> test. We are interested on the <em>API</em> side of things.</p>

<pre><code>$ rm test/controllers/screencast_controller_test.rb
</code></pre>

<p>Now create a new integration test at <em>test/integration/api_screencasts_test.rb</em>.</p>

<figure class='code'><figcaption><span>test/integration/api_screencasts_test.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;test_helper&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">ApiScreencastsTest</span> <span class="o">&lt;</span> <span class="ss">ActionDispatch</span><span class="p">:</span><span class="ss">:IntegrationTest</span>
</span><span class='line'>  <span class="nb">test</span> <span class="s2">&quot;get /api/screencasts.json&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">get</span> <span class="s2">&quot;/api/screencasts.json&quot;</span>
</span><span class='line'>    <span class="n">assert_response</span> <span class="ss">:success</span>
</span><span class='line'>    <span class="n">assert</span> <span class="n">body</span> <span class="o">==</span> <span class="no">Screencast</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'>    <span class="n">screencasts</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
</span><span class='line'>    <span class="n">assert</span> <span class="n">screencasts</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">3</span> <span class="c1"># because there are three fixtures (see screencasts.yml)</span>
</span><span class='line'>    <span class="n">assert</span> <span class="n">screencasts</span><span class="o">.</span><span class="n">any?</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="n">s</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="n">screencasts</span><span class="p">(</span><span class="ss">:fast_rails_commands</span><span class="p">)</span><span class="o">.</span><span class="n">title</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">test</span> <span class="s2">&quot;get /api/screencasts/:id&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">screencast</span> <span class="o">=</span> <span class="n">screencasts</span><span class="p">(</span><span class="ss">:fast_rails_commands</span><span class="p">)</span>
</span><span class='line'>    <span class="n">get</span> <span class="s2">&quot;/api/screencasts/</span><span class="si">#{</span><span class="n">screencast</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.json&quot;</span>
</span><span class='line'>    <span class="n">assert_response</span> <span class="ss">:success</span>
</span><span class='line'>    <span class="n">assert</span> <span class="n">body</span> <span class="o">==</span> <span class="n">screencast</span><span class="o">.</span><span class="n">to_json</span>
</span><span class='line'>    <span class="n">assert</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">body</span><span class="p">)</span><span class="o">[</span><span class="s2">&quot;title&quot;</span><span class="o">]</span> <span class="o">==</span> <span class="n">screencast</span><span class="o">.</span><span class="n">title</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Go ahead and run your tests:</p>

<pre><code>$ rake test
...
3 tests, 11 assertions, 0 failures, 0 errors, 0 skips
...
2 tests, 7 assertions, 0 failures, 0 errors, 0 skips
</code></pre>

<hr />

<p>Let&#8217;s stop for now. Our next steps will be getting our hands dirty with AngularJS.</p>

<h3>Go to <a href="/blog/2013/04/23/angularjs-on-rails-4-part-2/">Part 2</a></h3>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/20/rubymine-memory-config-vmoptions/">What Is the Best Memory Config for RubyMine?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-20T08:30:00-07:00" pubdate data-updated="true">Feb 20<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/20/rubymine-memory-config-vmoptions/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>RubyMine has become <em>awesomer</em> and <em>awesomer</em> over the years and is now my primary development tool for Rails development. One thing I&#8217;ve found frustrating however is that there is very little documentation on the best memory settings for your computer.</p>

<p>I&#8217;d like to get a thread going here with people identifying their computer, CPU, memory and config settings for RubyMine.</p>

<p>The config file can be located in the <code>bin</code> folder of your application. On my mac, the file is <code>/Applications/RubyMine/bin/idea.vmoptions</code>. If it doesn&#8217;t exist you may need to create it.</p>

<p>So here are my computer specs and vmoptions:</p>

<p>MacBook Pro Retina 2.6 GHz Intel Core i7 with 16 GB memory</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>-Xms128m
</span><span class='line'>-Xmx2048m
</span><span class='line'>-XX:MaxPermSize=500m
</span><span class='line'>-XX:ReservedCodeCacheSize=128m
</span><span class='line'>-XX:+UseCodeCacheFlushing
</span><span class='line'>-XX:+UseCompressedOops</span></code></pre></td></tr></table></div></figure>


<p>Please feel free to post yours in the comments below. I believe this will help others optimize their RubyMine experience.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/04/23/angularjs-on-rails-4-part-2/">AngularJS on Rails 4 - Part 2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/04/22/angularjs-on-rails-4-part-1/">AngularJS on Rails 4 - Part 1</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/02/20/rubymine-memory-config-vmoptions/">What is the best memory config for RubyMine?</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/cavneb">@cavneb</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'cavneb',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Eric Berry -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'coderberry';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
